<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.bnsr.edu_yun.frontstage.train.mapper.CourseHourMapper">
  <resultMap id="BaseResultMap" type="cn.bnsr.edu_yun.frontstage.train.po.CourseHour">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Nov 10 15:38:11 CST 2016.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="hour_title" jdbcType="VARCHAR" property="hour_title" />
    <result column="remarks" jdbcType="VARCHAR" property="remarks" />
    <result column="minute" jdbcType="INTEGER" property="minute" />
    <result column="second" jdbcType="INTEGER" property="second" />
    <result column="is_free" jdbcType="INTEGER" property="is_free" />
    <result column="hour_type" jdbcType="INTEGER" property="hour_type" />
    <result column="is_release" jdbcType="INTEGER" property="is_release" />
    <result column="attribute_type" jdbcType="INTEGER" property="attribute_type" />
    <result column="hour_code" jdbcType="VARCHAR" property="hour_code" />
    <result column="hour_seq" jdbcType="INTEGER" property="hour_seq" />
    <result column="course_file_id" jdbcType="BIGINT" property="course_file_id" />
    <result column="parent_id" jdbcType="BIGINT" property="parent_id" />
    <result column="course_id" jdbcType="BIGINT" property="course_id" />
    <result column="file_source" jdbcType="INTEGER" property="file_source" />
    <result column="frequency" jdbcType="INTEGER" property="frequency" />
    <result column="user_id" jdbcType="BIGINT" property="user_id" />
    <result column="start_time" jdbcType="TIMESTAMP" property="start_time" />
     <result column="check_status" jdbcType="INTEGER" property="check_status" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Nov 10 15:38:11 CST 2016.
    -->
    id, hour_title, remarks, minute, second, is_free, hour_type, is_release, attribute_type, 
    hour_code, hour_seq, course_file_id, parent_id, course_id, file_source, frequency, user_id,start_time,check_status
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Nov 10 15:38:11 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from course_hour
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Nov 10 15:38:11 CST 2016.
    -->
    delete from course_hour
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="cn.bnsr.edu_yun.frontstage.train.po.CourseHour">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Nov 10 15:38:11 CST 2016.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into course_hour (hour_title, remarks, minute, 
      second, is_free, hour_type, 
      is_release, attribute_type, hour_code, 
      hour_seq, course_file_id, user_id,
      parent_id, course_id, file_source, frequency
      )
    values (#{hour_title,jdbcType=VARCHAR}, #{remarks,jdbcType=VARCHAR}, #{minute,jdbcType=INTEGER}, 
      #{second,jdbcType=INTEGER}, #{is_free,jdbcType=INTEGER}, #{hour_type,jdbcType=INTEGER}, 
      #{is_release,jdbcType=INTEGER}, #{attribute_type,jdbcType=INTEGER}, #{hour_code,jdbcType=VARCHAR}, 
      #{hour_seq,jdbcType=INTEGER}, #{course_file_id,jdbcType=BIGINT}, #{user_id,jdbcType=BIGINT},
      #{parent_id,jdbcType=BIGINT}, #{course_id,jdbcType=BIGINT}, #{file_source,jdbcType=INTEGER}, #{frequency,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="cn.bnsr.edu_yun.frontstage.train.po.CourseHour">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Nov 10 15:38:11 CST 2016.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into course_hour
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="hour_title != null">
        hour_title,
      </if>
      <if test="remarks != null">
        remarks,
      </if>
      <if test="minute != null">
        minute,
      </if>
      <if test="second != null">
        second,
      </if>
      <if test="is_free != null">
        is_free,
      </if>
      <if test="hour_type != null">
        hour_type,
      </if>
      <if test="is_release != null">
        is_release,
      </if>
      <if test="attribute_type != null">
        attribute_type,
      </if>
      <if test="hour_code != null">
        hour_code,
      </if>
      <if test="hour_seq != null">
        hour_seq,
      </if>
      <if test="course_file_id != null">
        course_file_id,
      </if>
      <if test="parent_id != null">
        parent_id,
      </if>
      <if test="course_id != null">
        course_id,
      </if>
      <if test="file_source != null">
        file_source,
      </if>
      <if test="frequency != null">
        frequency,
      </if>
      <if test="user_id != null">
        user_id,
      </if>
      <if test="start_time != null">
        start_time,
      </if>
      <if test="check_status != null">
        check_status,
      </if>
     </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="hour_title != null">
        #{hour_title,jdbcType=VARCHAR},
      </if>
      <if test="remarks != null">
        #{remarks,jdbcType=VARCHAR},
      </if>
      <if test="minute != null">
        #{minute,jdbcType=INTEGER},
      </if>
      <if test="second != null">
        #{second,jdbcType=INTEGER},
      </if>
      <if test="is_free != null">
        #{is_free,jdbcType=INTEGER},
      </if>
      <if test="hour_type != null">
        #{hour_type,jdbcType=INTEGER},
      </if>
      <if test="is_release != null">
        #{is_release,jdbcType=INTEGER},
      </if>
      <if test="attribute_type != null">
        #{attribute_type,jdbcType=INTEGER},
      </if>
      <if test="hour_code != null">
        #{hour_code,jdbcType=VARCHAR},
      </if>
      <if test="hour_seq != null">
        #{hour_seq,jdbcType=INTEGER},
      </if>
      <if test="course_file_id != null">
        #{course_file_id,jdbcType=BIGINT},
      </if>
      <if test="parent_id != null">
        #{parent_id,jdbcType=BIGINT},
      </if>
      <if test="course_id != null">
        #{course_id,jdbcType=BIGINT},
      </if>
      <if test="file_source != null">
        #{file_source,jdbcType=INTEGER},
      </if>
      <if test="frequency != null">
        #{frequency,jdbcType=INTEGER},
      </if>
      <if test="user_id != null">
        #{user_id,jdbcType=BIGINT},
      </if>
       <if test="start_time != null">
        #{start_time,jdbcType=TIMESTAMP},
      </if>
       <if test="check_status != null">
        #{check_status,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="cn.bnsr.edu_yun.frontstage.train.po.CourseHour">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Nov 10 15:38:11 CST 2016.
    -->
    update course_hour
    <set>
      <if test="hour_title != null">
        hour_title = #{hour_title,jdbcType=VARCHAR},
      </if>
      <if test="remarks != null">
        remarks = #{remarks,jdbcType=VARCHAR},
      </if>
      <if test="minute != null">
        minute = #{minute,jdbcType=INTEGER},
      </if>
      <if test="second != null">
        second = #{second,jdbcType=INTEGER},
      </if>
      <if test="is_free != null">
        is_free = #{is_free,jdbcType=INTEGER},
      </if>
      <if test="hour_type != null">
        hour_type = #{hour_type,jdbcType=INTEGER},
      </if>
      <if test="is_release != null">
        is_release = #{is_release,jdbcType=INTEGER},
      </if>
      <if test="attribute_type != null">
        attribute_type = #{attribute_type,jdbcType=INTEGER},
      </if>
      <if test="hour_code != null">
        hour_code = #{hour_code,jdbcType=VARCHAR},
      </if>
      <if test="hour_seq != null">
        hour_seq = #{hour_seq,jdbcType=INTEGER},
      </if>
      <if test="course_file_id != null">
        course_file_id = #{course_file_id,jdbcType=BIGINT},
      </if>
      <if test="parent_id != null">
        parent_id = #{parent_id,jdbcType=BIGINT},
      </if>
      <if test="course_id != null">
        course_id = #{course_id,jdbcType=BIGINT},
      </if>
      <if test="file_source != null">
        file_source = #{file_source,jdbcType=INTEGER},
      </if>
      <if test="frequency != null">
        frequency = #{frequency,jdbcType=INTEGER},
      </if>
      <if test="user_id != null">
        user_id = #{user_id,jdbcType=BIGINT},
      </if>
      <if test="start_time != null">
        start_time = #{user_id,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="cn.bnsr.edu_yun.frontstage.train.po.CourseHour">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Nov 10 15:38:11 CST 2016.
    -->
    update course_hour
    set hour_title = #{hour_title,jdbcType=VARCHAR},
      remarks = #{remarks,jdbcType=VARCHAR},
      minute = #{minute,jdbcType=INTEGER},
      second = #{second,jdbcType=INTEGER},
      is_free = #{is_free,jdbcType=INTEGER},
      hour_type = #{hour_type,jdbcType=INTEGER},
      is_release = #{is_release,jdbcType=INTEGER},
      attribute_type = #{attribute_type,jdbcType=INTEGER},
      hour_code = #{hour_code,jdbcType=VARCHAR},
      hour_seq = #{hour_seq,jdbcType=INTEGER},
      course_file_id = #{course_file_id,jdbcType=BIGINT},
      parent_id = #{parent_id,jdbcType=BIGINT},
      course_id = #{course_id,jdbcType=BIGINT},
      file_source = #{file_source,jdbcType=INTEGER}
      frequency = #{frequency,jdbcType=INTEGER}
      user_id = #{user_id,jdbcType=BIGINT}
    where id = #{id,jdbcType=BIGINT}
  </update>
  
  <select id="queryHourList" resultType="cn.bnsr.edu_yun.frontstage.train.po.CourseHour">
  	SELECT * FROM course_hour 
  	WHERE course_id = #{courseId}
  	<if test="flag == false">
  	 	AND attribute_type != 1
  	</if>
  	<if test="flag == true">
	  	AND attribute_type = 1
  	</if>
  	ORDER BY hour_seq 
  </select>
  
  <select id="searchSeq" resultType="Integer">
	SELECT IFNULL(MAX(hour_seq),0) FROM course_hour 
	WHERE course_id = #{courseId} AND parent_id = #{parentId} 
  </select>
  
  <select id="queryByParentId" resultType="cn.bnsr.edu_yun.frontstage.train.po.CourseHour">
  	select * from course_hour where parent_id = #{_parameter} 
  </select>
  
  <select id="queryAllHour" resultType="cn.bnsr.edu_yun.frontstage.train.po.CourseHour">
 	SELECT id,hour_seq,hour_title,parent_id,course_id,attribute_type
 	FROM course_hour 
  	WHERE course_id in
	<foreach item="item" index="index" collection="courseIds" open="(" separator="," close=")">  
       #{item}  
	</foreach>  
  	<if test="flag == false">
  	 	AND attribute_type != 1
  	</if>
  	<if test="flag == true">
	  	AND attribute_type = 1
  	</if>
  </select>
  <select id="queryHourListUser" resultType="cn.bnsr.edu_yun.frontstage.train.view.CourseHourView" parameterType="cn.bnsr.edu_yun.frontstage.train.view.CourseHourView">
  	SELECT c.*
  	<if test="class_id != null" >
  	,ucl.is_studyed
  	</if>
  	FROM course_hour c
  	<if test="class_id != null" >
  	,user_class_hour ucl
  	</if>
	WHERE c.course_id = ${course_id}
	AND c.attribute_type != 1
	<if test="class_id != null" >
	<if test="user_id != null" >
	AND  ucl.user_id=${user_id} 
	</if>
	AND c.id=ucl.course_hour_id 
	AND ucl.course_id=${course_id}
	AND ucl.class_id=${class_id}
	</if>
  	ORDER BY c.hour_seq 
  </select>
  
  <select id="queryHourOfCourseCount" resultType="java.lang.Integer" parameterType="java.lang.Long">
  	SELECT count(id) FROM course_hour WHERE course_id=#{courseId}  AND attribute_type IN (2,5) LIMIT 1;
  </select>
</mapper>