<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.bnsr.edu_yun.frontstage.train.mapper.CourseInfoMapper">
  <resultMap id="BaseResultMap" type="cn.bnsr.edu_yun.frontstage.train.po.CourseInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 28 15:52:36 CST 2016.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="target" jdbcType="VARCHAR" property="target" />
    <result column="crowd" jdbcType="VARCHAR" property="crowd" />
    <result column="img" jdbcType="VARCHAR" property="img" />
    <result column="price" jdbcType="DOUBLE" property="price" />
    <result column="is_recommend" jdbcType="INTEGER" property="is_recommend" />
    <result column="recommend_time" jdbcType="TIMESTAMP" property="recommend_time" />
    <result column="recommend_seq" jdbcType="INTEGER" property="recommend_seq" />
    <result column="course_id" jdbcType="BIGINT" property="course_id" />
    <result column="is_default_img" jdbcType="INTEGER" property="is_default_img" />
  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="cn.bnsr.edu_yun.frontstage.train.po.CourseInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 28 15:52:36 CST 2016.
    -->
    <result column="profile" jdbcType="LONGVARCHAR" property="profile" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 28 15:52:36 CST 2016.
    -->
    id, target, crowd, img, price, is_recommend, recommend_time, recommend_seq, course_id, is_default_img
  </sql>
  <sql id="Blob_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 28 15:52:36 CST 2016.
    -->
    profile
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="ResultMapWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 28 15:52:36 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from course_info
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 28 15:52:36 CST 2016.
    -->
    delete from course_info
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="cn.bnsr.edu_yun.frontstage.train.po.CourseInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 28 15:52:36 CST 2016.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into course_info (target, crowd, img, 
      price, is_recommend, recommend_time, 
      recommend_seq, course_id, profile, is_default_img
      )
    values (#{target,jdbcType=VARCHAR}, #{crowd,jdbcType=VARCHAR}, #{img,jdbcType=VARCHAR}, 
      #{price,jdbcType=DOUBLE}, #{is_recommend,jdbcType=INTEGER}, #{recommend_time,jdbcType=TIMESTAMP}, 
      #{recommend_seq,jdbcType=INTEGER}, #{course_id,jdbcType=BIGINT}, #{profile,jdbcType=LONGVARCHAR},
      #{is_default_img,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="cn.bnsr.edu_yun.frontstage.train.po.CourseInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 28 15:52:36 CST 2016.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into course_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="target != null">
        target,
      </if>
      <if test="crowd != null">
        crowd,
      </if>
      <if test="img != null">
        img,
      </if>
      <if test="price != null">
        price,
      </if>
      <if test="is_recommend != null">
        is_recommend,
      </if>
      <if test="recommend_time != null">
        recommend_time,
      </if>
      <if test="recommend_seq != null">
        recommend_seq,
      </if>
      <if test="course_id != null">
        course_id,
      </if>
      <if test="profile != null">
        profile,
      </if>
      <if test="is_default_img != null">
        is_default_img,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="target != null">
        #{target,jdbcType=VARCHAR},
      </if>
      <if test="crowd != null">
        #{crowd,jdbcType=VARCHAR},
      </if>
      <if test="img != null">
        #{img,jdbcType=VARCHAR},
      </if>
      <if test="price != null">
        #{price,jdbcType=DOUBLE},
      </if>
      <if test="is_recommend != null">
        #{is_recommend,jdbcType=INTEGER},
      </if>
      <if test="recommend_time != null">
        #{recommend_time,jdbcType=TIMESTAMP},
      </if>
      <if test="recommend_seq != null">
        #{recommend_seq,jdbcType=INTEGER},
      </if>
      <if test="course_id != null">
        #{course_id,jdbcType=BIGINT},
      </if>
      <if test="profile != null">
        #{profile,jdbcType=LONGVARCHAR},
      </if>
      <if test="is_default_img != null">
        #{is_default_img,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="cn.bnsr.edu_yun.frontstage.train.po.CourseInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 28 15:52:36 CST 2016.
    -->
    update course_info
    <set>
      <if test="target != null">
        target = #{target,jdbcType=VARCHAR},
      </if>
      <if test="crowd != null">
        crowd = #{crowd,jdbcType=VARCHAR},
      </if>
      <if test="img != null">
        img = #{img,jdbcType=VARCHAR},
      </if>
      <if test="price != null">
        price = #{price,jdbcType=DOUBLE},
      </if>
      <if test="is_recommend != null">
        is_recommend = #{is_recommend,jdbcType=INTEGER},
      </if>
      <if test="recommend_time != null">
        recommend_time = #{recommend_time,jdbcType=TIMESTAMP},
      </if>
      <if test="recommend_seq != null">
        recommend_seq = #{recommend_seq,jdbcType=INTEGER},
      </if>
      <if test="course_id != null">
        course_id = #{course_id,jdbcType=BIGINT},
      </if>
      <if test="profile != null">
        profile = #{profile,jdbcType=LONGVARCHAR},
      </if>
      <if test="is_default_img != null">
        is_default_img = #{is_default_img,jdbcType=INTEGER},
      </if>
      
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="cn.bnsr.edu_yun.frontstage.train.po.CourseInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 28 15:52:36 CST 2016.
    -->
    update course_info
    set target = #{target,jdbcType=VARCHAR},
      crowd = #{crowd,jdbcType=VARCHAR},
      img = #{img,jdbcType=VARCHAR},
      price = #{price,jdbcType=DOUBLE},
      is_recommend = #{is_recommend,jdbcType=INTEGER},
      recommend_time = #{recommend_time,jdbcType=TIMESTAMP},
      recommend_seq = #{recommend_seq,jdbcType=INTEGER},
      course_id = #{course_id,jdbcType=BIGINT},
      profile = #{profile,jdbcType=LONGVARCHAR},
      is_default_img = #{is_default_img,jdbcType=INTEGER}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="cn.bnsr.edu_yun.frontstage.train.po.CourseInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 28 15:52:36 CST 2016.
    -->
    update course_info
    set target = #{target,jdbcType=VARCHAR},
      crowd = #{crowd,jdbcType=VARCHAR},
      img = #{img,jdbcType=VARCHAR},
      price = #{price,jdbcType=DOUBLE},
      is_recommend = #{is_recommend,jdbcType=INTEGER},
      recommend_time = #{recommend_time,jdbcType=TIMESTAMP},
      recommend_seq = #{recommend_seq,jdbcType=INTEGER},
      course_id = #{course_id,jdbcType=BIGINT},
      is_default_img = #{is_default_img,jdbcType=INTEGER}
    where id = #{id,jdbcType=BIGINT}
  </update>
  
  <select id="queryCourseDetail" parameterType="java.lang.Long" resultType="cn.bnsr.edu_yun.frontstage.train.view.CourseView">
  	 SELECT c.status,c.title,c.id as id,t.id as courseInfoId, c.type, c.is_check, 
  	 	t.profile ,t.target,t.crowd ,(CASE WHEN t.is_default_img=0 THEN (SELECT path FROM cert_model_picture WHERE id=258 ) ELSE t.img END) AS img ,t.price , c.user_id as userId,
  	 	GROUP_CONCAT(CAST(u.username AS char)SEPARATOR " ") as teachers
  	 FROM course_info t 
  	 LEFT JOIN course c ON t.course_id = c.id 
  	 LEFT JOIN teacher_relation ct ON ct.source_id = c.id 
	 LEFT JOIN user u ON u.id= ct.user_id
  	 WHERE t.course_id = #{_parameter} 
  	 AND ct.is_display = 0
  	 AND ct.type != 1
	 AND ct.source_type = 0
  </select>
  
  <select id="getMaxSeq" resultType="java.lang.Integer">
  	SELECT IFNULL(MAX(recommend_seq),0)
  	FROM course_info 
  	WHERE is_recommend = 0
  </select>
  
</mapper>