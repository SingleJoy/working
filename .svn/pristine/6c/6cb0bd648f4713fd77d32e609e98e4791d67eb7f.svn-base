<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.bnsr.edu_yun.frontstage.base.mapper.UserInfoMapper">
  <resultMap id="BaseResultMap" type="cn.bnsr.edu_yun.frontstage.base.po.UserInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 16 11:23:37 CST 2016.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="user_id" jdbcType="BIGINT" property="user_id" />
    <result column="school" jdbcType="VARCHAR" property="school" />
    <result column="course" jdbcType="VARCHAR" property="course" />
    <result column="titles" jdbcType="VARCHAR" property="titles" />
    <result column="pubver_id" jdbcType="VARCHAR" property="pubver_id" />
    <result column="school_id" jdbcType="BIGINT" property="school_id" />
    <result column="grade_id" jdbcType="INTEGER" property="grade_id" />
    <result column="true_name" jdbcType="VARCHAR" property="true_name" />
    <result column="sex" jdbcType="INTEGER" property="sex" />
    <result column="ID_number" jdbcType="VARCHAR" property="ID_number" />
    <result column="picture1" jdbcType="VARCHAR" property="picture1" />
    <result column="picture2" jdbcType="VARCHAR" property="picture2" />
    <result column="picture3" jdbcType="VARCHAR" property="picture3" />
    <result column="apply_time" jdbcType="TIMESTAMP" property="apply_time" />
    <result column="review_time" jdbcType="TIMESTAMP" property="review_time" />
    <result column="type" jdbcType="INTEGER" property="type" />
    <result column="certificated" jdbcType="INTEGER" property="certificated" />
    <result column="position_id" jdbcType="INTEGER" property="position_id" />
    <result column="area_id" jdbcType="VARCHAR" property="area_id" />
    <result column="titles_id" jdbcType="INTEGER" property="titles_id" />
    <result column="certificate_type" jdbcType="INTEGER" property="certificate_type" />
    
    <result column="signature" jdbcType="VARCHAR" property="signature" />
    <result column="rank" jdbcType="INTEGER" property="rank" />
    <result column="microblog" jdbcType="VARCHAR" property="microblog" />
    <result column="blog_open" jdbcType="INTEGER" property="blog_open" />
    <result column="wechat" jdbcType="VARCHAR" property="wechat" />
    <result column="chat_open" jdbcType="INTEGER" property="chat_open" />
    <result column="qq" jdbcType="VARCHAR" property="qq" />
    <result column="qq_open" jdbcType="INTEGER" property="qq_open" />
    <result column="default_profile" jdbcType="INTEGER" property="default_profile" />
    <result column="default_signature" jdbcType="INTEGER" property="default_signature" />
  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="cn.bnsr.edu_yun.frontstage.base.po.UserInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 16 11:23:37 CST 2016.
    -->
    <result column="profile" jdbcType="LONGVARCHAR" property="profile" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 16 11:23:37 CST 2016.
    -->
    id, user_id, school, course, rank, microblog, blog_open, wechat, chat_open, qq, 
    qq_open,titles, pubver_id, school_id, grade_id, true_name, sex, 
    ID_number, picture1, picture2, picture3, apply_time, review_time, type, certificated, 
    position_id, area_id, titles_id, certificate_type,default_profile,default_signature,signature
  </sql>
  <sql id="Blob_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 16 11:23:37 CST 2016.
    -->
    profile
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="ResultMapWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 16 11:23:37 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from user_info
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 16 11:23:37 CST 2016.
    -->
    delete from user_info
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="cn.bnsr.edu_yun.frontstage.base.po.UserInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 16 11:23:37 CST 2016.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into user_info (user_id, school, course, 
      signature, rank, microblog, 
      blog_open, wechat, chat_open, 
      qq, qq_open,
      titles, pubver_id, school_id, 
      grade_id, true_name, sex, 
      ID_number, picture1, picture2, 
      picture3, apply_time, review_time, 
      type, certificated, position_id, 
      area_id, titles_id, certificate_type, 
      profile,default_profile,default_signature)
    values (#{user_id,jdbcType=BIGINT}, #{school,jdbcType=VARCHAR}, #{course,jdbcType=VARCHAR}, 
      #{signature,jdbcType=VARCHAR}, #{rank,jdbcType=VARCHAR},#{microblog,jdbcType=VARCHAR},
      #{blog_open,jdbcType=INTEGER},#{wechat,jdbcType=VARCHAR},#{chat_open,jdbcType=INTEGER},
      #{qq,jdbcType=VARCHAR},#{qq_open,jdbcType=INTEGER},
      #{titles,jdbcType=VARCHAR}, #{pubver_id,jdbcType=VARCHAR}, #{school_id,jdbcType=BIGINT}, 
      #{grade_id,jdbcType=INTEGER}, #{true_name,jdbcType=VARCHAR}, #{sex,jdbcType=INTEGER}, 
      #{ID_number,jdbcType=VARCHAR}, #{picture1,jdbcType=VARCHAR}, #{picture2,jdbcType=VARCHAR}, 
      #{picture3,jdbcType=VARCHAR}, #{apply_time,jdbcType=TIMESTAMP}, #{review_time,jdbcType=TIMESTAMP}, 
      #{type,jdbcType=INTEGER}, #{certificated,jdbcType=INTEGER}, #{position_id,jdbcType=INTEGER}, 
      #{area_id,jdbcType=VARCHAR}, #{titles_id,jdbcType=INTEGER}, #{certificate_type,jdbcType=INTEGER}, 
      #{profile,jdbcType=LONGVARCHAR}, #{default_profile,jdbcType=INTEGER}, #{default_signature,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="cn.bnsr.edu_yun.frontstage.base.po.UserInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 16 11:23:37 CST 2016.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into user_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="user_id != null">
        user_id,
      </if>
      <if test="school != null">
        school,
      </if>
      <if test="course != null">
        course,
      </if>
      <if test="signature != null">
        signature,
      </if>
      <if test="rank != null">
        rank,
      </if><if test="microblog != null">
        microblog,
      </if>
      <if test="blog_open != null">
        blog_open,
      </if><if test="wechat != null">
        wechat,
      </if>
      <if test="chat_open != null">
        chat_open,
      </if><if test="qq != null">
        qq,
      </if>
      <if test="qq_open != null">
        qq_open,
      </if>
      <if test="titles != null">
        titles,
      </if>
      <if test="pubver_id != null">
        pubver_id,
      </if>
      <if test="school_id != null">
        school_id,
      </if>
      <if test="grade_id != null">
        grade_id,
      </if>
      <if test="true_name != null">
        true_name,
      </if>
      <if test="sex != null">
        sex,
      </if>
      <if test="ID_number != null">
        ID_number,
      </if>
      <if test="picture1 != null">
        picture1,
      </if>
      <if test="picture2 != null">
        picture2,
      </if>
      <if test="picture3 != null">
        picture3,
      </if>
      <if test="apply_time != null">
        apply_time,
      </if>
      <if test="review_time != null">
        review_time,
      </if>
      <if test="type != null">
        type,
      </if>
      <if test="certificated != null">
        certificated,
      </if>
      <if test="position_id != null">
        position_id,
      </if>
      <if test="area_id != null">
        area_id,
      </if>
      <if test="titles_id != null">
        titles_id,
      </if>
      <if test="certificate_type != null">
        certificate_type,
      </if>
      <if test="profile != null">
        profile,
      </if>
      <if test="default_profile != null">
        default_profile,
      </if>
      <if test="default_signature != null">
        default_signature,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="user_id != null">
        #{user_id,jdbcType=BIGINT},
      </if>
      <if test="school != null">
        #{school,jdbcType=VARCHAR},
      </if>
      <if test="course != null">
        #{course,jdbcType=VARCHAR},
      </if>
      <if test="signature != null">
        #{signature,jdbcType=VARCHAR},
      </if>
      <if test="rank != null">
        #{rank,jdbcType=VARCHAR},
      </if>
      <if test="microblog != null">
        #{microblog,jdbcType=VARCHAR},
      </if>
      <if test="blog_open != null">
        #{blog_open,jdbcType=INTEGER},
      </if>
      <if test="wechat != null">
        #{wechat,jdbcType=VARCHAR},
      </if>
      <if test="chat_open != null">
        #{chat_open,jdbcType=INTEGER},
      </if>
      <if test="qq != null">
        #{qq,jdbcType=VARCHAR},
      </if>
      <if test="qq_open != null">
        #{qq_open,jdbcType=INTEGER},
      </if>
      <if test="titles != null">
        #{titles,jdbcType=VARCHAR},
      </if>
      <if test="pubver_id != null">
        #{pubver_id,jdbcType=VARCHAR},
      </if>
      <if test="school_id != null">
        #{school_id,jdbcType=BIGINT},
      </if>
      <if test="grade_id != null">
        #{grade_id,jdbcType=INTEGER},
      </if>
      <if test="true_name != null">
        #{true_name,jdbcType=VARCHAR},
      </if>
      <if test="sex != null">
        #{sex,jdbcType=INTEGER},
      </if>
      <if test="ID_number != null">
        #{ID_number,jdbcType=VARCHAR},
      </if>
      <if test="picture1 != null">
        #{picture1,jdbcType=VARCHAR},
      </if>
      <if test="picture2 != null">
        #{picture2,jdbcType=VARCHAR},
      </if>
      <if test="picture3 != null">
        #{picture3,jdbcType=VARCHAR},
      </if>
      <if test="apply_time != null">
        #{apply_time,jdbcType=TIMESTAMP},
      </if>
      <if test="review_time != null">
        #{review_time,jdbcType=TIMESTAMP},
      </if>
      <if test="type != null">
        #{type,jdbcType=INTEGER},
      </if>
      <if test="certificated != null">
        #{certificated,jdbcType=INTEGER},
      </if>
      <if test="position_id != null">
        #{position_id,jdbcType=INTEGER},
      </if>
      <if test="area_id != null">
        #{area_id,jdbcType=VARCHAR},
      </if>
      <if test="titles_id != null">
        #{titles_id,jdbcType=INTEGER},
      </if>
      <if test="certificate_type != null">
        #{certificate_type,jdbcType=INTEGER},
      </if>
      <if test="profile != null">
        #{profile,jdbcType=LONGVARCHAR},
      </if>
      <if test="default_profile != null">
        #{default_profile,jdbcType=INTEGER},
      </if>
      <if test="default_signature != null">
        #{default_signature,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="cn.bnsr.edu_yun.frontstage.base.po.UserInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 16 11:23:37 CST 2016.
    -->
    update user_info
    <set>
      <if test="user_id != null">
        user_id = #{user_id,jdbcType=BIGINT},
      </if>
      <if test="school != null">
        school = #{school,jdbcType=VARCHAR},
      </if>
      <if test="course != null">
        course = #{course,jdbcType=VARCHAR},
      </if>
      <if test="signature != null">
        signature = #{signature,jdbcType=VARCHAR},
      </if>
      <if test="rank != null">
        rank = #{rank,jdbcType=VARCHAR},
      </if>
      <if test="microblog != null">
        microblog = #{microblog,jdbcType=VARCHAR},
      </if>
      <if test="blog_open != null">
        blog_open = #{blog_open,jdbcType=INTEGER},
      </if>
      <if test="wechat != null">
        wechat = #{wechat,jdbcType=VARCHAR},
      </if>
      <if test="chat_open != null">
        chat_open = #{chat_open,jdbcType=INTEGER},
      </if>
      <if test="qq != null">
        qq = #{qq,jdbcType=VARCHAR},
      </if>
      <if test="qq_open != null">
        qq_open = #{qq_open,jdbcType=INTEGER},
      </if>
      <if test="titles != null">
        titles = #{titles,jdbcType=VARCHAR},
      </if>
      <if test="pubver_id != null">
        pubver_id = #{pubver_id,jdbcType=VARCHAR},
      </if>
      <if test="school_id != null">
        school_id = #{school_id,jdbcType=BIGINT},
      </if>
      <if test="grade_id != null">
        grade_id = #{grade_id,jdbcType=INTEGER},
      </if>
      <if test="true_name != null">
        true_name = #{true_name,jdbcType=VARCHAR},
      </if>
      <if test="sex != null">
        sex = #{sex,jdbcType=INTEGER},
      </if>
      <if test="ID_number != null">
        ID_number = #{ID_number,jdbcType=VARCHAR},
      </if>
      <if test="picture1 != null">
        picture1 = #{picture1,jdbcType=VARCHAR},
      </if>
      <if test="picture2 != null">
        picture2 = #{picture2,jdbcType=VARCHAR},
      </if>
      <if test="picture3 != null">
        picture3 = #{picture3,jdbcType=VARCHAR},
      </if>
      <if test="apply_time != null">
        apply_time = #{apply_time,jdbcType=TIMESTAMP},
      </if>
      <if test="review_time != null">
        review_time = #{review_time,jdbcType=TIMESTAMP},
      </if>
      <if test="type != null">
        type = #{type,jdbcType=INTEGER},
      </if>
      <if test="certificated != null">
        certificated = #{certificated,jdbcType=INTEGER},
      </if>
      <if test="position_id != null">
        position_id = #{position_id,jdbcType=INTEGER},
      </if>
      <if test="area_id != null">
        area_id = #{area_id,jdbcType=VARCHAR},
      </if>
      <if test="titles_id != null">
        titles_id = #{titles_id,jdbcType=INTEGER},
      </if>
      <if test="certificate_type != null">
        certificate_type = #{certificate_type,jdbcType=INTEGER},
      </if>
      <if test="profile != null">
        profile = #{profile,jdbcType=LONGVARCHAR},
      </if>
      <if test="default_profile != null">
        default_profile = #{default_profile,jdbcType=INTEGER},
      </if>
      <if test="default_signature != null">
        default_signature = #{default_signature,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="cn.bnsr.edu_yun.frontstage.base.po.UserInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 16 11:23:37 CST 2016.
    -->
    update user_info
    set user_id = #{user_id,jdbcType=BIGINT},
      school = #{school,jdbcType=VARCHAR},
      course = #{course,jdbcType=VARCHAR},
      signature = #{signature,jdbcType=VARCHAR},
      rank = #{rank,jdbcType=VARCHAR},
      microblog = #{microblog,jdbcType=VARCHAR},
      blog_open = #{blog_open,jdbcType=INTEGER},
      wechat = #{wechat,jdbcType=VARCHAR},
      chat_open = #{chat_open,jdbcType=INTEGER},
      qq = #{qq,jdbcType=VARCHAR},
      qq_open = #{qq_open,jdbcType=INTEGER},
      titles = #{titles,jdbcType=VARCHAR},
      pubver_id = #{pubver_id,jdbcType=VARCHAR},
      school_id = #{school_id,jdbcType=BIGINT},
      grade_id = #{grade_id,jdbcType=INTEGER},
      true_name = #{true_name,jdbcType=VARCHAR},
      sex = #{sex,jdbcType=INTEGER},
      ID_number = #{ID_number,jdbcType=VARCHAR},
      picture1 = #{picture1,jdbcType=VARCHAR},
      picture2 = #{picture2,jdbcType=VARCHAR},
      picture3 = #{picture3,jdbcType=VARCHAR},
      apply_time = #{apply_time,jdbcType=TIMESTAMP},
      review_time = #{review_time,jdbcType=TIMESTAMP},
      type = #{type,jdbcType=INTEGER},
      certificated = #{certificated,jdbcType=INTEGER},
      position_id = #{position_id,jdbcType=INTEGER},
      area_id = #{area_id,jdbcType=VARCHAR},
      titles_id = #{titles_id,jdbcType=INTEGER},
      certificate_type = #{certificate_type,jdbcType=INTEGER},
      profile = #{profile,jdbcType=LONGVARCHAR},
      default_profile = #{default_profile,jdbcType=INTEGER},
      default_signature = #{default_signature,jdbcType=INTEGER}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="cn.bnsr.edu_yun.frontstage.base.po.UserInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 16 11:23:37 CST 2016.
    -->
    update user_info
    set user_id = #{user_id,jdbcType=BIGINT},
      school = #{school,jdbcType=VARCHAR},
      course = #{course,jdbcType=VARCHAR},
      signature = #{signature,jdbcType=VARCHAR},
      rank = #{rank,jdbcType=VARCHAR},
      microblog = #{microblog,jdbcType=VARCHAR},
      blog_open = #{blog_open,jdbcType=INTEGER},
      wechat = #{wechat,jdbcType=VARCHAR},
      chat_open = #{chat_open,jdbcType=INTEGER},
      qq = #{qq,jdbcType=VARCHAR},
      qq_open = #{qq_open,jdbcType=INTEGER},
      titles = #{titles,jdbcType=VARCHAR},
      pubver_id = #{pubver_id,jdbcType=VARCHAR},
      school_id = #{school_id,jdbcType=BIGINT},
      grade_id = #{grade_id,jdbcType=INTEGER},
      true_name = #{true_name,jdbcType=VARCHAR},
      sex = #{sex,jdbcType=INTEGER},
      ID_number = #{ID_number,jdbcType=VARCHAR},
      picture1 = #{picture1,jdbcType=VARCHAR},
      picture2 = #{picture2,jdbcType=VARCHAR},
      picture3 = #{picture3,jdbcType=VARCHAR},
      apply_time = #{apply_time,jdbcType=TIMESTAMP},
      review_time = #{review_time,jdbcType=TIMESTAMP},
      type = #{type,jdbcType=INTEGER},
      certificated = #{certificated,jdbcType=INTEGER},
      position_id = #{position_id,jdbcType=INTEGER},
      area_id = #{area_id,jdbcType=VARCHAR},
      titles_id = #{titles_id,jdbcType=INTEGER},
      certificate_type = #{certificate_type,jdbcType=INTEGER},
      default_profile = #{default_profile,jdbcType=INTEGER},
      default_signature = #{default_signature,jdbcType=INTEGER}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <select id="getByUserId" parameterType="java.lang.Long" resultMap="ResultMapWithBLOBs">
  	SELECT
  	<include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" /> 
    FROM user_info
  	<if test="_parameter != null">
  	WHERE user_id = #{_parameter}
  	</if>
  </select>
  <select id="selectByBack"  resultType="cn.bnsr.edu_yun.frontstage.base.po.UserInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Aug 04 09:22:21 CST 2016.
    -->
    SELECT 
    (SELECT COUNT(recommended.id) FROM recommended 
    WHERE recommended.source_id=user_info.user_id
    and recommended.source_type in (1,2)
    and recommended.valid_time>NOW() 
    ) AS is_recommended,
    user_info.*,user.username as username FROM 
    user_info,user,area
    WHERE  user_info.user_id=user.id
  	and user_info.area_id=area.area_id
     <if test="s_username != null and s_username!=''">
      and user.username like ${s_username}
    </if>
    <if test="s_phone!=null and s_phone !='' ">
      and user.phone like ${s_phone}
    </if>
    <if test="school_id != null and school_id !=-1">
      and user_info.school_id = ${school_id}
    </if>
    <if test="area_id != null">
       and area.area_id = '${area_id}'
    </if>
    <if test="certificated != null">
     and
        user_info.certificated = #{certificated,jdbcType=INTEGER}
      </if>
       <if test="type == 0">
     and
        user_info.type=0
      </if>
        <if test="type != 0">
     and
        user_info.type!=0
      </if>
    ORDER BY ${sort}  ${order}  
    <if test="rows gt 0">
      LIMIT  #{start,jdbcType=BIGINT},#{rows,jdbcType=BIGINT} 
    </if>
  </select>
  <select id="selectCountByBack"  resultType="java.lang.Integer" parameterType="cn.bnsr.edu_yun.frontstage.base.po.UserCertificated">
  SELECT COUNT(*)  FROM user_info,user,area
   WHERE  user_info.user_id=user.id
    and user_info.area_id=area.area_id
    <if test="s_username != null and s_username!=''">
      and user.username like ${s_username}
    </if>
    <if test="s_phone!=null and s_phone !='' ">
      and user.phone like ${s_phone}
    </if>
    <if test="school_id != null and school_id !=-1">
      and user_info.school_id = ${school_id}
    </if>
    <if test="area_id != null">
       and area.area_id = '${area_id}'
    </if>
    <if test="certificated != null">
     and
        user_info.certificated = #{certificated,jdbcType=INTEGER}
      </if>
     <if test="type == 0">
     and
        user_info.type=0
      </if>
        <if test="type != 0">
     and
        user_info.type!=0
      </if>
  </select>
  
  
  <select id="findTeacher"  resultType="cn.bnsr.edu_yun.frontstage.train.view.TeacherView" parameterType="cn.bnsr.edu_yun.frontstage.train.view.TeacherView">
     SELECT u.id AS user_id, u.username as user_name,ui.true_name,ui.school,ui.course,ui.titles 
     FROM user u 
     LEFT JOIN user_info ui ON u.id=ui.user_id 
     WHERE u.user_type=3 AND ui.certificated=1  
     AND u.id!=#{user_id,jdbcType=BIGINT} 
     <if test="titles != null and titles !='' ">
	      AND  ui.titles = #{titles,jdbcType=VARCHAR} 
	 </if>
	 <if test="course != null and course !='' ">
	      <![CDATA[AND  ui.course LIKE '%${course}%']]>  
	 </if>
	 <if test="true_name != null and true_name !='' ">
	      <![CDATA[AND  ui.true_name LIKE '%${true_name}%']]>  
	 </if>
     ORDER BY u.id
	 LIMIT ${startLine},${rows}
  </select>
  <select id="countTeacher"  resultType="java.lang.Integer" parameterType="cn.bnsr.edu_yun.frontstage.train.view.TeacherView">
     SELECT COUNT(*) 
     FROM user u 
     LEFT JOIN user_info ui ON u.id=ui.user_id
     WHERE u.user_type=3 AND ui.certificate_type=1 
     AND ui.user_id!=#{user_id,jdbcType=BIGINT}
     <if test="titles != null and titles !='' ">
	      AND  ui.titles = #{titles,jdbcType=VARCHAR} 
	 </if>
	 <if test="course != null and course !='' ">
	      <![CDATA[AND  ui.course LIKE '%${course}%']]>  
	 </if>
	 <if test="true_name != null and true_name !='' ">
	      <![CDATA[AND  ui.true_name LIKE '%${true_name}%']]>  
	 </if>
  </select>
  <select id="findTitles"  resultType="java.lang.String" parameterType="java.lang.Long" >
     SELECT DISTINCT ui.titles 
	 FROM user u
	 LEFT JOIN user_info ui ON u.id=ui.user_id 
	 WHERE  u.user_type=3 AND ui.certificated=1 
	 AND user_id!=#{user_id,jdbcType=BIGINT}
  </select>
  
  <update id="updateDefaultSet" parameterType="cn.bnsr.edu_yun.frontstage.base.po.UserInfo">
     update user_info
    <set>
      <if test="signature != null">
        signature = #{signature,jdbcType=VARCHAR},
      </if>
      <if test="profile != null">
        profile = #{profile,jdbcType=LONGVARCHAR},
      </if>
     </set>
     WHERE 1=1
     <if test="signature != null">
        AND default_signature=1
     </if>
     <if test="profile != null">
        AND default_profile=1
     </if>
  </update>
    <select id="ageDistribution" parameterType="cn.bnsr.edu_yun.backstage.base.view.UserStatsView" resultType="cn.bnsr.edu_yun.backstage.base.view.UserStatsView">
       SELECT y.ageInterval,COUNT(*) AS newNum FROM 
       (SELECT <![CDATA[
	   CASE WHEN x.age>=10 AND x.age<=19 THEN '10-19' 
	   WHEN x.age>=20 AND x.age<=29 THEN '20-29' 
	   WHEN x.age>=30 AND x.age<=39 THEN '30-39'
	   WHEN x.age>=40 AND x.age<=49 THEN '40-49'
	   WHEN x.age>=50 AND x.age<=59 THEN '50-59' END]]>  AS ageInterval FROM
	   (SELECT CASE WHEN LENGTH(ui.ID_number)=15 THEN YEAR(now())- YEAR(SUBSTR(ui.ID_number,7,6)) WHEN LENGTH(ui.ID_number)=18 THEN YEAR(now())- YEAR(SUBSTR(ui.ID_number,7,8)) END AS age
	   FROM sys_log sl INNER JOIN user_info ui ON sl.user_id=ui.user_id WHERE ui.ID_number IS NOT NULL AND ui.ID_number!='' AND sl.log_type=1 AND sl.do_from!=2 
	    <if  test="startTime != '' and endTime != '' ">
		 	<![CDATA[ AND sl.create_time >= '${startTime}' AND sl.create_time < '${endTime}' ]]>  
		</if>
		<if  test="days != '' ">
			<![CDATA[AND sl.create_time LIKE '${days}%' ]]>  
		</if>
	   GROUP BY sl.user_id) x
	   ) y WHERE y.ageInterval IS NOT NULL
	   GROUP BY y.ageInterval ORDER BY newNum DESC 
	
  </select>
  <select id="querySexNum" parameterType="cn.bnsr.edu_yun.backstage.base.view.UserStatsView" resultType="java.lang.Integer">
      SELECT COUNT(DISTINCT sl.user_id) 
	  FROM sys_log sl INNER JOIN user_info ui ON sl.user_id=ui.user_id 
	  WHERE sl.log_type=1 AND sl.do_from!=2 
	  <if  test="sex == 1 ">
	 	 AND ui.sex=1
	  </if>
	  <if  test="sex == 2 ">
	 	 AND ui.sex=0
	  </if>
	  <if  test="startTime != '' and endTime != '' ">
	 	 <![CDATA[ AND sl.create_time >= '${startTime}' AND sl.create_time < '${endTime}' ]]>  
	  </if>
	  <if  test="days != '' ">
		 <![CDATA[AND sl.create_time LIKE '${days}%' ]]>  
	  </if>
  
  </select>
  <select id="queryAgeByStu" parameterType="cn.bnsr.edu_yun.backstage.base.view.UserStatsView" resultType="cn.bnsr.edu_yun.backstage.base.view.UserStatsView">
       SELECT y.ageInterval,COUNT(*) AS newNum FROM 
       (SELECT <![CDATA[
	   CASE WHEN x.age>=16 AND x.age<=24 THEN '16-24' 
		WHEN x.age>=25 AND x.age<=34 THEN '25-34' 
		WHEN x.age>=35 AND x.age<=44 THEN '35-44'
		WHEN x.age>=45 AND x.age<=54 THEN '45-54'
		WHEN x.age>=55 THEN '55' END]]>  AS ageInterval FROM
	   (SELECT CASE WHEN LENGTH(ui.ID_number)=15 THEN YEAR(now())- YEAR(SUBSTR(ui.ID_number,7,6)) WHEN LENGTH(ui.ID_number)=18 THEN YEAR(now())- YEAR(SUBSTR(ui.ID_number,7,8)) END AS age
	   FROM user_study us INNER JOIN user_info ui ON us.user_id=ui.user_id WHERE ui.ID_number IS NOT NULL AND ui.ID_number!='' AND us.source_type=0
	    <if  test="startTime != '' and endTime != '' ">
		 	<![CDATA[ AND us.add_time >= '${startTime}' AND us.add_time < '${endTime}' ]]>  
		</if>
		<if  test="days != '' ">
			<![CDATA[AND us.add_time LIKE '${days}%' ]]>  
		</if>
	   GROUP BY us.user_id) x
	   ) y WHERE y.ageInterval IS NOT NULL
	   GROUP BY y.ageInterval ORDER BY newNum DESC 
  </select>
</mapper>