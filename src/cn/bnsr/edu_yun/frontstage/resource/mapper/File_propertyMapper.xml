<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.bnsr.edu_yun.frontstage.resource.mapper.File_propertyMapper">
  <resultMap id="BaseResultMap" type="cn.bnsr.edu_yun.frontstage.resource.po.File_property">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="download_times" jdbcType="INTEGER" property="download_times" />
    <result column="collection_times" jdbcType="INTEGER" property="collection_times" />
    <result column="click_times" jdbcType="INTEGER" property="click_times" />
    <result column="score" jdbcType="TINYINT" property="score" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    id, download_times, collection_times, click_times, score
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from file_property
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    delete from file_property
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="cn.bnsr.edu_yun.frontstage.resource.po.File_property">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into file_property (download_times, collection_times, 
      click_times, score)
    values (#{download_times,jdbcType=INTEGER}, #{collection_times,jdbcType=INTEGER}, 
      #{click_times,jdbcType=INTEGER}, #{score,jdbcType=TINYINT})
  </insert>
  <insert id="insertSelective" parameterType="cn.bnsr.edu_yun.frontstage.resource.po.File_property">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into file_property
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="download_times != null">
        download_times,
      </if>
      <if test="collection_times != null">
        collection_times,
      </if>
      <if test="click_times != null">
        click_times,
      </if>
       <if test="score != null">
        score,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="download_times != null">
        #{download_times,jdbcType=INTEGER},
      </if>
      <if test="collection_times != null">
        #{collection_times,jdbcType=INTEGER},
      </if>
      <if test="click_times != null">
        #{click_times,jdbcType=INTEGER},
      </if>
    <if test="score != null">
        #{score,jdbcType=TINYINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="cn.bnsr.edu_yun.frontstage.resource.po.File_property">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    update file_property
    <set>
      <if test="download_times != null">
        download_times = #{download_times,jdbcType=INTEGER},
      </if>
      <if test="collection_times != null">
        collection_times = #{collection_times,jdbcType=INTEGER},
      </if>
      <if test="click_times != null">
        click_times = #{click_times,jdbcType=INTEGER},
      </if>
      <if test="score != null">
        score = #{score,jdbcType=DOUBLE},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="cn.bnsr.edu_yun.frontstage.resource.po.File_property">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    update file_property
    set download_times = #{download_times,jdbcType=INTEGER},
      collection_times = #{collection_times,jdbcType=INTEGER},
      click_times = #{click_times,jdbcType=INTEGER},
     score = #{score,jdbcType=TINYINT}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <select id="queryCount" resultType="cn.bnsr.edu_yun.frontstage.resource.view.FileView">
  	SELECT sum(download_times) as downloadNum ,sum(click_times) as browseNum
  	FROM  file_property 
	<if test="_parameter != null">
	WHERE id in 
	 	<foreach item="item" index="index" collection="list" open="(" separator="," close=")">  
             #{item}  
       	</foreach>  
  	</if>
  </select>
  
  <select id="querScoreNum" resultType="java.lang.String">
  	<if test="type == 'score'">
		SELECT SUM(p.score) 
  	</if>
  	<if test="type == 'num'">
  		SELECT count(*)
  	</if>
	FROM file_property p 
	WHERE p.id IN( 
		SELECT t.property_id  
		FROM file_base t 
		WHERE t.upload_user = #{userId} 
		AND t.status = 0
		)
	AND p.score !=0
  </select>
</mapper>