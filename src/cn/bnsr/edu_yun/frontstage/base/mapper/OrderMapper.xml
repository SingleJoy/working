<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.bnsr.edu_yun.frontstage.base.mapper.OrderMapper" >
  <resultMap id="BaseResultMap" type="cn.bnsr.edu_yun.frontstage.base.po.Order" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 20 15:18:33 CST 2016.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="number" property="number" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="create_time" property="create_time" jdbcType="TIMESTAMP" />
    <result column="amount" property="amount" jdbcType="DOUBLE" />
    <result column="pay_amount" property="pay_amount" jdbcType="DOUBLE" />
    <result column="coupon_code" property="coupon_code" jdbcType="VARCHAR" />
    <result column="coupon_remarks" property="coupon_remarks" jdbcType="VARCHAR" />
    <result column="coupon_cash" property="coupon_cash" jdbcType="DOUBLE" />
    <result column="order_from" property="order_from" jdbcType="INTEGER" />
    <result column="buy_type" property="buy_type" jdbcType="INTEGER" />
    <result column="buy_id" property="buy_id" jdbcType="BIGINT" />
    <result column="user_id" property="user_id" jdbcType="BIGINT" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 20 15:18:33 CST 2016.
    -->
    id, name, number, status, create_time, amount, pay_amount, coupon_code, coupon_remarks, 
    coupon_cash, order_from, buy_type, buy_id, user_id
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 20 15:18:33 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from order
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 20 15:18:33 CST 2016.
    -->
    delete from order
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="cn.bnsr.edu_yun.frontstage.base.po.Order" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 20 15:18:33 CST 2016.
    -->
    <selectKey resultType="java.lang.Long" keyProperty="id" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into order (name, number, status, 
      create_time, amount, pay_amount, 
      coupon_code, coupon_remarks, coupon_cash, 
      order_from, buy_type, buy_id, 
      user_id)
    values (#{name,jdbcType=VARCHAR}, #{number,jdbcType=VARCHAR}, #{status,jdbcType=INTEGER}, 
      #{create_time,jdbcType=TIMESTAMP}, #{amount,jdbcType=DOUBLE}, #{pay_amount,jdbcType=DOUBLE}, 
      #{coupon_code,jdbcType=VARCHAR}, #{coupon_remarks,jdbcType=VARCHAR}, #{coupon_cash,jdbcType=DOUBLE}, 
      #{order_from,jdbcType=INTEGER}, #{buy_type,jdbcType=INTEGER}, #{buy_id,jdbcType=BIGINT}, 
      #{user_id,jdbcType=BIGINT})
  </insert>
  <insert id="insertSelective" parameterType="cn.bnsr.edu_yun.frontstage.base.po.Order" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 20 15:18:33 CST 2016.
    -->
    <selectKey resultType="java.lang.Long" keyProperty="id" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into order
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="name != null" >
        name,
      </if>
      <if test="number != null" >
        number,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="create_time != null" >
        create_time,
      </if>
      <if test="amount != null" >
        amount,
      </if>
      <if test="pay_amount != null" >
        pay_amount,
      </if>
      <if test="coupon_code != null" >
        coupon_code,
      </if>
      <if test="coupon_remarks != null" >
        coupon_remarks,
      </if>
      <if test="coupon_cash != null" >
        coupon_cash,
      </if>
      <if test="order_from != null" >
        order_from,
      </if>
      <if test="buy_type != null" >
        buy_type,
      </if>
      <if test="buy_id != null" >
        buy_id,
      </if>
      <if test="user_id != null" >
        user_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="number != null" >
        #{number,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="create_time != null" >
        #{create_time,jdbcType=TIMESTAMP},
      </if>
      <if test="amount != null" >
        #{amount,jdbcType=DOUBLE},
      </if>
      <if test="pay_amount != null" >
        #{pay_amount,jdbcType=DOUBLE},
      </if>
      <if test="coupon_code != null" >
        #{coupon_code,jdbcType=VARCHAR},
      </if>
      <if test="coupon_remarks != null" >
        #{coupon_remarks,jdbcType=VARCHAR},
      </if>
      <if test="coupon_cash != null" >
        #{coupon_cash,jdbcType=DOUBLE},
      </if>
      <if test="order_from != null" >
        #{order_from,jdbcType=INTEGER},
      </if>
      <if test="buy_type != null" >
        #{buy_type,jdbcType=INTEGER},
      </if>
      <if test="buy_id != null" >
        #{buy_id,jdbcType=BIGINT},
      </if>
      <if test="user_id != null" >
        #{user_id,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="cn.bnsr.edu_yun.frontstage.base.po.Order" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 20 15:18:33 CST 2016.
    -->
    update order
    <set >
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="number != null" >
        number = #{number,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="create_time != null" >
        create_time = #{create_time,jdbcType=TIMESTAMP},
      </if>
      <if test="amount != null" >
        amount = #{amount,jdbcType=DOUBLE},
      </if>
      <if test="pay_amount != null" >
        pay_amount = #{pay_amount,jdbcType=DOUBLE},
      </if>
      <if test="coupon_code != null" >
        coupon_code = #{coupon_code,jdbcType=VARCHAR},
      </if>
      <if test="coupon_remarks != null" >
        coupon_remarks = #{coupon_remarks,jdbcType=VARCHAR},
      </if>
      <if test="coupon_cash != null" >
        coupon_cash = #{coupon_cash,jdbcType=DOUBLE},
      </if>
      <if test="order_from != null" >
        order_from = #{order_from,jdbcType=INTEGER},
      </if>
      <if test="buy_type != null" >
        buy_type = #{buy_type,jdbcType=INTEGER},
      </if>
      <if test="buy_id != null" >
        buy_id = #{buy_id,jdbcType=BIGINT},
      </if>
      <if test="user_id != null" >
        user_id = #{user_id,jdbcType=BIGINT},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="cn.bnsr.edu_yun.frontstage.base.po.Order" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 20 15:18:33 CST 2016.
    -->
    update order
    set name = #{name,jdbcType=VARCHAR},
      number = #{number,jdbcType=VARCHAR},
      status = #{status,jdbcType=INTEGER},
      create_time = #{create_time,jdbcType=TIMESTAMP},
      amount = #{amount,jdbcType=DOUBLE},
      pay_amount = #{pay_amount,jdbcType=DOUBLE},
      coupon_code = #{coupon_code,jdbcType=VARCHAR},
      coupon_remarks = #{coupon_remarks,jdbcType=VARCHAR},
      coupon_cash = #{coupon_cash,jdbcType=DOUBLE},
      order_from = #{order_from,jdbcType=INTEGER},
      buy_type = #{buy_type,jdbcType=INTEGER},
      buy_id = #{buy_id,jdbcType=BIGINT},
      user_id = #{user_id,jdbcType=BIGINT}
    where id = #{id,jdbcType=BIGINT}
  </update>
  
  
   <select id="selectByUserId" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    select 
    *
    from `order`,file_base,file_catalog
    where `order`.user_id = #{user_id,jdbcType=BIGINT} and `order`.file_id=file_base.id and file_base.catalog_id=file_catalog.id  ORDER BY create_time DESC LIMIT #{start,jdbcType=BIGINT},#{pageSize,jdbcType=BIGINT} 
  </select>
  <select id="selectByUserIdSuccess" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    select 
    *
    from `order`,file_base,file_catalog
    where `order`.user_id = #{user_id,jdbcType=BIGINT} and 
    `order`.is_success = #{is_success,jdbcType=BIGINT}  and
    `order`.file_id=file_base.id and file_base.catalog_id=file_catalog.id  ORDER BY create_time DESC LIMIT #{start,jdbcType=BIGINT},#{pageSize,jdbcType=BIGINT} 
  </select>
     <select id="selectByUserIdCount" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    select 
    *
    from `order`,file_base,file_catalog
    where `order`.user_id = #{user_id,jdbcType=BIGINT} and `order`.file_id=file_base.id and file_base.catalog_id=file_catalog.id  
  </select>
  <select id="selectByUserIdSuccessCount" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    select 
    *
    from `order`,file_base,file_catalog
    where `order`.user_id = #{user_id,jdbcType=BIGINT} and 
    `order`.is_success = #{is_success,jdbcType=BIGINT}  and
    `order`.file_id=file_base.id and file_base.catalog_id=file_catalog.id 
  </select>
  <select id="selectAllByTime"  resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    select 
    *
    from `order`,file_base,file_catalog,user
    where `order`.user_id=user.id and `order`.file_id=file_base.id and file_base.catalog_id=file_catalog.id and user.username like #{username,jdbcType=VARCHAR} and `order`.order_number like #{order_number,jdbcType=VARCHAR} ORDER BY `order`.create_time DESC LIMIT #{start,jdbcType=BIGINT},#{pageSize,jdbcType=BIGINT} 
  </select>
  <select id="selectAllByTimeASC" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    select 
    *
    from `order`,file_base,file_catalog,user
    where `order`.user_id=user.id and `order`.file_id=file_base.id and file_base.catalog_id=file_catalog.id and user.username like #{username,jdbcType=VARCHAR} and `order`.order_number like #{order_number,jdbcType=VARCHAR} ORDER BY `order`.create_time asc LIMIT #{start,jdbcType=BIGINT},#{pageSize,jdbcType=BIGINT} 
  </select>
  <select id="selectAllByAmount"  resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    select 
    *
    from `order`,file_base,file_catalog,user
    where `order`.user_id=user.id and `order`.file_id=file_base.id and file_base.catalog_id=file_catalog.id and user.username like #{username,jdbcType=VARCHAR} and `order`.order_number like #{order_number,jdbcType=VARCHAR} ORDER BY `order`.transaction_amount DESC LIMIT #{start,jdbcType=BIGINT},#{pageSize,jdbcType=BIGINT} 
  </select>
  <select id="selectAllByAmountASC" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    select 
    *
    from `order`,file_base,file_catalog,user
    where `order`.user_id=user.id and `order`.file_id=file_base.id and file_base.catalog_id=file_catalog.id and user.username like #{username,jdbcType=VARCHAR} and `order`.order_number like #{order_number,jdbcType=VARCHAR} ORDER BY `order`.transaction_amount asc LIMIT #{start,jdbcType=BIGINT},#{pageSize,jdbcType=BIGINT} 
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 16:00:41 CST 2016.
    -->
    select 
    *
    from `order` </select>
  <select id="queryOrderStats" parameterType="cn.bnsr.edu_yun.backstage.base.view.OrderStatsView" resultType="cn.bnsr.edu_yun.backstage.base.view.OrderStatsView">
	SELECT 
		<if test="year != '' and month == '' ">
			DATE_FORMAT(o.create_time,'%Y-%m') days,
		</if>
		<if test="year != '' and month != '' ">
			DATE_FORMAT(o.create_time,'%Y-%m-%d') days,
		</if>
		<if test="year == '' ">
			DATE_FORMAT(o.create_time,'%Y-%m-%d') days,
		</if>
		count(*) as orderNum,
		sum(o.transaction_amount) as amountNum
	FROM `order` o   WHERE o.is_success =2 
	<![CDATA[AND o.create_time LIKE  '%${days}%']]>  
	GROUP BY days;
  </select>
</mapper>